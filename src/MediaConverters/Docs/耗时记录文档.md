# 性能记录

## WMF 图片转换

Commit: e7f9c0adfe736c56e4e0207c15701ccd92b822d1

测试设备:

- CPU: Hygon C86-3G-3G (OPN:3350)
- 系统: Kylin Linux Desktop EDU V10 银河麒麟桌面操作系统（教育版）V10 2403

### 非 AOT 版本

```
lindexi@lindexi-pc:~/lin/sync/lin64$ ./DotNetCampus.MediaConverter
ReadJsonFile Cost 4ms
ParseJsonFile Cost 5ms
Start optimize image file. File='image.wmf' Total Cost 5ms
Copy new file to '/home/lindexi/linux-x64/Test_ldaqazwr.3nx/Copy_1ckqx3ma.hht_image.wmf' Total Cost 183ms
Copy new file Cost 179ms. ImageFile: '/home/lindexi/linux-x64/Test_ldaqazwr.3nx/Copy_1ckqx3ma.hht_image.wmf' Total Cost 183ms
Start convert emf or wmf to png by Inkscape. File='/home/lindexi/linux-x64/Test_ldaqazwr.3nx/Copy_1ckqx3ma.hht_image.wmf' Total Cost 185ms
Convert emf or wmf to svg by Inkscape failed. We will continue use libwmf to convert the image. File='/home/lindexi/linux-x64/Test_ldaqazwr.3nx/Copy_1ckqx3ma.hht_image.wmf' Exception: System.ComponentModel.Win32Exception (2): An error occurred trying to start process 'inkscape' with working directory '/home/lindexi/linux-x64'. No such file or directory
   at System.Diagnostics.Process.ForkAndExecProcess(ProcessStartInfo startInfo, String resolvedFilename, String[] argv, String[] envp, String cwd, Boolean setCredentials, UInt32 userId, UInt32 groupId, UInt32[] groups, Int32& stdinFd, Int32& stdoutFd, Int32& stderrFd, Boolean usesTerminal, Boolean throwOnNoExec)
   at System.Diagnostics.Process.StartCore(ProcessStartInfo startInfo)
   at System.Diagnostics.Process.Start(ProcessStartInfo startInfo)
   at DotNetCampus.MediaConverters.Imaging.Optimizations.EnhancedGraphicsMetafileOptimization.ConvertWithInkscape(ImageFileOptimizationContext context)
   Total Cost 201ms
ConvertWithInkscape Cost 17ms Total Cost 202ms
ConvertWithInkscapeLibWmf Cost 17ms Total Cost 220ms
Load sk svg Cost 507ms Total Cost 729ms
Save sk svg to png Cost 17ms. OutputFile='/home/lindexi/linux-x64/Test_ldaqazwr.3nx/SVG_gh1sulx2.ezs.png' Total Cost 747ms
Convert svg to png file Cost 527ms. File='/home/lindexi/linux-x64/Test_ldaqazwr.3nx/FixSVG_csmcz2s1.p5b.svg' Total Cost 747ms
ConvertWmfOrEmfToPngFile Cost 564ms. ImageFile: '/home/lindexi/linux-x64/Test_ldaqazwr.3nx/Copy_1ckqx3ma.hht_image.wmf' Total Cost 747ms
Success ConvertWmfOrEmfToPngFile. Update current image file to '/home/lindexi/linux-x64/Test_ldaqazwr.3nx/SVG_gh1sulx2.ezs.png' Total Cost 748ms
Start optimize image with ImageSharp. ImageFile: '/home/lindexi/linux-x64/Test_ldaqazwr.3nx/SVG_gh1sulx2.ezs.png' Total Cost 748ms
Load image with ImageSharp Cost 79ms. ImageFile: '/home/lindexi/linux-x64/Test_ldaqazwr.3nx/SVG_gh1sulx2.ezs.png' Total Cost 827ms
Optimize image with ImageSharp Cost 3ms. ImageFile: '/home/lindexi/linux-x64/Test_ldaqazwr.3nx/SVG_gh1sulx2.ezs.png' Total Cost 831ms
Save optimized image with ImageSharp Cost 63ms. OutputImageFile: '/home/lindexi/linux-x64/Test_ldaqazwr.3nx/kipm4qr5.rav.png' Total Cost 895ms
OptimizeImageFileAsync Cost 895ms. File='/home/lindexi/linux-x64/image.wmf'
Success converted image. Cost 917ms. OutputFile='/home/lindexi/linux-x64/Test_ldaqazwr.3nx/1.png' Total Cost 895ms
```

### AOT 版本

```
lindexi@lindexi-pc:~/lin/sync/lin64$ ./DotNetCampus.MediaConverter
ReadJsonFile Cost 0ms
ParseJsonFile Cost 0ms
Start optimize image file. File='image.wmf' Total Cost 0ms
Check imageFile Exists Cost 0ms. Total Cost 0ms
CreateDirectory workingFolder Cost 0ms. Total Cost 0ms
Copy new file to '/home/lindexi/linux-x64/Test_3udgyrfq.ewe/Copy_cexmekrd.0ne_image.wmf' Total Cost 0ms
Copy new file Cost 0ms. ImageFile: '/home/lindexi/linux-x64/Test_3udgyrfq.ewe/Copy_cexmekrd.0ne_image.wmf' Total Cost 0ms
Start convert emf or wmf to png by Inkscape. File='/home/lindexi/linux-x64/Test_3udgyrfq.ewe/Copy_cexmekrd.0ne_image.wmf' Total Cost 0ms
Convert emf or wmf to svg by Inkscape failed. We will continue use libwmf to convert the image. File='/home/lindexi/linux-x64/Test_3udgyrfq.ewe/Copy_cexmekrd.0ne_image.wmf' Exception: System.ComponentModel.Win32Exception (2): An error occurred trying to start process 'inkscape' with working directory '/home/lindexi/linux-x64'. No such file or directory
   at System.Diagnostics.Process.ForkAndExecProcess(ProcessStartInfo, String, String[], String[], String, Boolean, UInt32, UInt32, UInt32[], Int32&, Int32&, Int32&, Boolean, Boolean) + 0x404
   at System.Diagnostics.Process.StartCore(ProcessStartInfo) + 0x303
   at System.Diagnostics.Process.Start(ProcessStartInfo) + 0x3b
   at DotNetCampus.MediaConverters.Imaging.Optimizations.EnhancedGraphicsMetafileOptimization.ConvertWithInkscape(ImageFileOptimizationContext) + 0x1fe
   Total Cost 10ms
ConvertWithInkscape Cost 10ms Total Cost 10ms
Run wmf2svg process Cost 173ms Total Cost 184ms
ConvertWithInkscapeLibWmf Cost 174ms Total Cost 184ms
Load sk svg Cost 176ms Total Cost 361ms
Save sk svg to png Cost 11ms. OutputFile='/home/lindexi/linux-x64/Test_3udgyrfq.ewe/SVG_gjvqrzhr.haf.png' Total Cost 373ms
Convert svg to png file Cost 188ms. File='/home/lindexi/linux-x64/Test_3udgyrfq.ewe/FixSVG_ywzqj0xe.b0s.svg' Total Cost 373ms
ConvertWmfOrEmfToPngFile Cost 373ms. ImageFile: '/home/lindexi/linux-x64/Test_3udgyrfq.ewe/Copy_cexmekrd.0ne_image.wmf' Total Cost 373ms
Success ConvertWmfOrEmfToPngFile. Update current image file to '/home/lindexi/linux-x64/Test_3udgyrfq.ewe/SVG_gjvqrzhr.haf.png' Total Cost 373ms
Start optimize image with ImageSharp. ImageFile: '/home/lindexi/linux-x64/Test_3udgyrfq.ewe/SVG_gjvqrzhr.haf.png' Total Cost 373ms
Load image with ImageSharp Cost 1ms. ImageFile: '/home/lindexi/linux-x64/Test_3udgyrfq.ewe/SVG_gjvqrzhr.haf.png' Total Cost 374ms
Optimize image with ImageSharp Cost 0ms. ImageFile: '/home/lindexi/linux-x64/Test_3udgyrfq.ewe/SVG_gjvqrzhr.haf.png' Total Cost 375ms
Save optimized image with ImageSharp Cost 9ms. OutputImageFile: '/home/lindexi/linux-x64/Test_3udgyrfq.ewe/vuwjg5bf.xmt.png' Total Cost 384ms
OptimizeImageFileAsync Cost 384ms. File='/home/lindexi/linux-x64/image.wmf'
Success converted image. Cost 387ms. OutputFile='/home/lindexi/linux-x64/Test_3udgyrfq.ewe/1.png' Total Cost 384ms
```

可见 AOT 的版本只需非 AOT 版本的一半时间